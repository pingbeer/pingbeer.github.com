<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "https://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<meta name="format-detection" content="telephone=no">
	<meta http-equiv="Cache-Control" content="max-age=1" />
	<title>浦发银行信用卡</title> 	
	<link rel="stylesheet" href="./css/basic.css?v=1">
	<link rel="stylesheet" href="https://magicactivity.oss-cn-hangzhou.aliyuncs.com/activity/common_css/smoothness/jquery-ui-1.10.1.custom.css">
	<link rel="stylesheet" href="./css/customDialog.css?v=2">
	<script src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
    <script src="./js/lib/jquery.min.js"></script>
    <script src="./js/lib/jquery-ui-1.10.1.custom.min.js"></script>
    <script src="./js/lib/bootstrap.min.js"></script>
    <script src="./js/lib/jquery.slimscroll.js"></script>
	<script src="./js/lib/myBase64Util.js?v=1"></script>
	<script src="./js/lib/jquery.qrcode.min.js"></script>	
	<script src="js/lib/lufylegend.ui-0.10.0.min.js"></script>
	<script src="js/lib/lufylegend-1.9.7.min.js"></script>
	<script src="./myjs/lib/common.js?v=1"></script>
    <script src="./myjs/lib/customDialog.js?v=1"></script>
	<script src="./js/myCommon.js?v=20012"></script>
	<script src="./js/commonShare.js?v=20012"></script>
	<script src="./js/stat.js?v=1"></script>	
	<script>
	var gamePage = new GamePage();

if(window.__skipInitPage == undefined || !window.__skipInitPage) {
    $(document).ready(function() {
    	gamePage.initGame();
        commonShare.initWxSetting(gamePage.initPage,gamePage.doSendShare,false,true);
        console.log("$(document).ready() initPage");
//        gamePage.initPage();
    });
}

function GamePage() {

    var _this = this;

	var saveCnt = null;
	
	var gameInit = null;
	
	var timer = null;
	
	this.initGame = function(){
		gameInit = new game();
	}
    
    this.initPage = function() {                
        $my.async.series([
            initFormInfo,
  			showUserInfo,
  			finishLoad,
            ], function(totalCount, doneCount, error) {
            if(totalCount == doneCount) {
                console.log("indexPage initPage() done");
            }
        });
    };

	function initFormInfo(callback){
		stat.pageStat("game");
		if($my.getCookie("fm") == null){
			$('.b_2').show();
			$my.setCookie("fm","1","{expires: 10000000, path: '', domain: '', secure: false}");
		    $('.b_2').unbind('click').bind('click',function(){ 
		        $('.b_2').hide();
		    });
		}
		setHtmlFontSize(); 
		if(callback) {
			callback();
		}
	}
	
	function finishLoad(callback){
		$('[id="page"]').removeClass('vis_h');
		
		$('.b_2_btn').unbind('touchstart').bind('touchstart',
			function(){
				$('.b_2').fadeOut();
			}
		);
        console.log("finishLoad() done");
		if(callback) {
			callback();
		}
	}
	
	function goIndex(){
//		event.stopPropagation();
		window.location = "index.html";
	}
	function goLottery(){
		window.location = 'lottery.html';
	}
	function showUserInfo(callback){
		$my.ajax({
			url: $my.getCloudDataServiceUrl(),
			data: {
				serviceType: "com.ebuy.activity.service.spdbcat.SpdBcatService",
				serviceMethod: "getUserInfo"
			},
			success: function(response) {
				if($my.checkPageResult(response)){
					var myObject = $.parseJSON(response).resultData;
					saveCnt = myObject.saveCnt;
					if(saveCnt >= 1){
			            clearInterval(timer);   
			            timer = null;
						var div = '<div class="b_1_1 qcj"><h4>有人救助了小黑猫<br>你可以</h4><div class="b_1_btn" id="continue">[继续游戏]</div><span style="font-size: 0.5rem;">或者</span><div class="b_1_btn" id="play">开始新游戏</div></div>';
						$('.b_1').empty();
						$('.b_1').append(div);
						
						$('#play').unbind('touchstart').bind('touchstart',
							function(){
								$('#play').unbind('touchstart');
								playGame(-1);
							}
						);
						$('#continue').unbind('touchstart').bind('touchstart',
							function(){
								$('#continue').unbind('touchstart');
								playGame(1);
							}
						);
						$('.b_1').show();
						$('.b_1_1').show();
					}
	                console.log("showUserInfo() done");
					if(callback) {
						callback();
					}
				}
			},
		});
	}
	this.play = function(confirm){
		playGame(confirm);
	}
	function playGame(confirm){
		event.stopPropagation();
		var _restart = -1;
		if(saveCnt > 0 && confirm == 1){
			_restart = 1;
		}
		$my.ajax({
			url: $my.getCloudDataServiceUrl(),
			data: {
				serviceType: "com.ebuy.activity.service.spdbcat.SpdBcatService",
				serviceMethod: "doGameReady", 
				restart:_restart
			},
			success: function(response) {
				if($my.checkPageResult(response)){
					var myObject = $.parseJSON(response).resultData;
					var code = $.parseJSON(response).resultCode;
					if(code == "SPD_BCAT_000001"){ 
						_gid = myObject.gameId;
						$('.b_1').hide();
						//TODO 回复游戏历史状态
						var hInfo = myObject.extraInfo;
						
						gameInit.start(hInfo);
					}else{
						$('.b_1').hide();
						_gid = myObject;
						gameInit.start();
					}
				}
			},
		});
	}
	
	function endGame(gameId){
		
		var paramPoints = 35;
		
		var extraInfo =35;
		
		$my.ajax({
			url: $my.getCloudDataServiceUrl(),
			data: {
				serviceType: "com.ebuy.activity.service.spdbcat.SpdBcatService",
				serviceMethod: "doGameEnd",
				gameId:gameId,
				gamePoints:paramPoints,
				extraInfo:extraInfo
			},
			success: function(response) {
				if($my.checkPageResult(response)){
					var myObject = $.parseJSON(response).resultData;
					if(paramPoints >= 30){
						var div = '<div class="b_1_1 qcj"><h4>游戏结束</h4><span>抓了'+paramPoints+'只蝴蝶<br/>获得一次抽奖资格</span>	<div class="b_1_btn" id="goLottery">去抽奖</div><div class="b_1_btn" id="goIndex">返回首页</div></div>';
						$('.b_1').empty();
						$('.b_1').append(div);
					}else{
						var div = '<div class="b_1_1 qcj"><h4>游戏结束</h4><span>抓了'+paramPoints+'只蝴蝶<br/>差一点就能抽奖了</span>	<div class="b_1_btn" id="shareGame">save me</div><div class="b_1_btn" id="goIndex">返回首页</div></div>';
						$('.b_1').empty();
						$('.b_1').append(div);
					}
					$('#goIndex').on('touchstart', function(){
						goIndex()
					});
					$('#goLottery').on('touchstart', function(){
						goLottery();
					});
					$('#play').unbind('touchstart').bind('touchstart',
						function(){
							$('#play').unbind('touchstart');
							playGame(-1);
						}
					);
					$('#continue').unbind('touchstart').bind('touchstart',
						function(){
							$('#continue').unbind('touchstart');
							playGame(1);
						}
					);
		   	    	$('#shareGame').on('touchstart', function(){
		   	    		shareGame();
		   	    	});
					$('.b_1').show();
					$('.b_1_1').show();
					var shareLink = commonShare.getIndexLineLink();
					commonShare.setRecommendLink(shareLink+"&gameId="+gameId);	
					commonShare.setRecommendTitle("快来救我");
					commonShare.setRecommendDesc("急！有一只小黑猫正等待救助！");
					commonShare.setRecommendImg("https://magicactivity.oss-cn-hangzhou.aliyuncs.com/spdbcat/shareSaveWx.jpg");
				}
			},
		});
	}

	this.doSendShare = function(){
		$my.ajax({
	         url: $my.getCloudDataServiceUrl(),
	         data: {
	             serviceType: "com.ebuy.activity.service.spdbcat.SpdBcatService",
	             serviceMethod: "shareSuccNotify"
	         },
	         success: function(response) {
	       	  if($my.checkPageResult(response)){
//				showDialog.showInfoDialog({title : "提示", msgInfo : "分享成功",});
				//TODO 开启计时器，循环调用后端，当cnt》1时，停止计时器，并提示继续开始
				timer = setInterval(function(){    
			       	showUserInfo();
			        if(saveCnt > 1){    
			            clearInterval(timer);   
			        }  			     
			    },5000);   
				
				$("#fxtc").fadeOut();
		    	stat.clickStat("share");
	       	  }
	         },
	   	});
	}
	
	function shareGame(){
		$("#fxtc").fadeIn();
		$("#fxtc").on('touchstart', function(){
			$("#fxtc").fadeOut();
		});
	}
    
    function game(){
    	var 苦数据列表;
		var 苦舞台层;
		var 苦舞台索引 = 0;
		var 常移步 = 8;
		var 常移步慢 = 8;
		var 常移步快 = 12;
		var 苦值 = 3;
		var 苦停止标志;
		var 苦游戏主体;
		var 苦运行地图;
		var 苦运行角色;
		var 苦名人层;
		var 苦项目层;
		var 苦星控制;
		
		var 苦加载数据 = [

		{name : "effect",path : "imgs/effect.png"}, 
		{name : "logo",path : "imgs/kaishi.jpg"}, 
		{name : "inputbox",path : "imgs/inputbox.png"}, 
		{name : "spiritEffect",path : "imgs/spiritEffect.png"}, 
		{name : "b_background",path : "imgs/beijing.jpg"}, 
		{name : "m_background",path : "imgs/m_background.png"}, 
		{name : "stage",path : "imgs/stage.png"}, 
		{name : "chara",path : "imgs/chara.png"},     
		{name : "bird",path : "imgs/bird.png"}, 
		{name : "gui",path : "imgs/gui.png"}, 
		{name : "window",path : "imgs/shibai.jpg"}, 
		{name : "HP_bg",path : "imgs/hp_bg.png"},  
		{name : "HP_value",path : "imgs/hp_value.png"},
		];
		init(1000/30, "legend", 640, 1136, 主);
		function 主() {
			var protocol = location.protocol;
			if(LGlobal.mobile){
				LGlobal.stageScale = LStageScaleMode.NO_BORDER;
				LSystem.screen(LStage.FULL_SCREEN);
			}
			LGlobal.setDebug(true);
			LMouseEventContainer.set(LMouseEvent.MOUSE_DOWN,true);
			LMouseEventContainer.set(LMouseEvent.MOUSE_UP,true);
			LMouseEventContainer.set(LMouseEvent.MOUSE_MOVE,true);
			loadingLayer = new LoadingSample4();
			addChild(loadingLayer);
			LLoadManage.load(苦加载数据, function(progress) {
				loadingLayer.setProgress(progress);
			}, 当图片加载完);
		}
		function 当图片加载完(result){
			苦数据列表 = result;
			removeChild(loadingLayer);
			loadingLayer = null;
			苦舞台层 = new LSprite();
			addChild(苦舞台层);
		//	游戏开始();
			var logo = new 商标();
			苦舞台层.addChild(logo);
			return;
			var fps = new FPS();
			addChild(fps);
			
		}
		this.start = function(points){
			游戏开始(points);
		}
		function 游戏开始(points){
			苦舞台层.die();
			苦舞台层.removeAllChild();
			LTweenLite.removeAll();
			常移步 = 常移步慢;
			苦停止标志 = false;
			苦游戏主体 = new 游戏主体(points);
			苦舞台层.addChild(苦游戏主体);
			return;	
		}
		///////////////////////////////////////
		function 背景(){
			base(this,LSprite,[]);
			this.初始();
		}
		背景.prototype.初始 = function(){
			var 俺 = this;
			俺.back = new LBitmap(new LBitmapData(苦数据列表["b_background"],0,0,640,1136));//800,480
			俺.backX = 0;
			俺.addChild(俺.back);
			俺.grass = new LBitmap(new LBitmapData(苦数据列表["m_background"]));
			俺.grass.y = LGlobal.height - 俺.grass.getHeight();
			俺.addChild(俺.grass);
			俺.addEventListener(LEvent.ENTER_FRAME,俺.心跳);
		};
		背景.prototype.心跳 = function(event){
			var 俺 = event.target;
			if(苦游戏主体.为停止())return;
			俺.backX += 常移步*0.1;
			if(俺.backX > LGlobal.width){
				俺.backX -= LGlobal.width;
			}
			俺.back.bitmapData.setCoordinate(俺.backX,0);
			俺.grass.x -= 常移步*0.5;
			if(俺.grass.x + 960 < 0){
				俺.grass.x = LGlobal.width;
			}
		};
		///////////////////////////////////////
		function 我(hp){
			base(this,LSprite,[]);
			this.初始(hp);
		}
		我.走 = "走";
		我.飞 = "飞";
		我.伤 = "伤";
		我.跳 = "跳";
		我.prototype.初始 = function(hp){
			var 俺 = this;
			俺.hp = hp;
			var effect = new LBitmap(new LBitmapData(苦数据列表["effect"]));
			effect.x = -180;
			effect.y = -70;
			俺.addChild(effect);
			俺.effect = effect;
			俺.effect.visible = false;
			var data = new LBitmapData(苦数据列表["chara"],0,0,133,113);
			var list = LGlobal.divideCoordinate(400,451,4,3);
			俺.action = 我.走;
			俺.heroShadows = [new LBitmap(data),new LBitmap(data)];
			俺.heroShadows[0].alpha = 0.7;
			俺.heroShadows[1].alpha = 0.3;
			俺.heroShadows[0].visible = false;
			俺.heroShadows[1].visible = false;
			俺.addChild(俺.heroShadows[0]);
			俺.addChild(俺.heroShadows[1]);
			俺.hero = new LAnimationTimeline(data,list);
			俺.hero.setLabel(我.走,0,0);
			俺.hero.setLabel(我.飞,1,0);
			俺.hero.setLabel(我.伤,2,0);
			俺.hero.setLabel(我.跳,3,0);
			俺.hero.x = -48;
			俺.hero.y = -120;
			俺.hero.speed = 6;
			俺.addChild(俺.hero);
			俺.heroShadows[0].x = 俺.hero.x - 20;
			俺.heroShadows[0].y = 俺.hero.y;
			俺.heroShadows[1].x = 俺.hero.x - 40;
			俺.heroShadows[1].y = 俺.hero.y;
			俺.vy = 0;
			俺.jumpCount = 0;
			俺.distance = 0;
			俺.spiritCount = 0;
			俺.countValue = 常移步*5;
			俺.addEventListener(LEvent.ENTER_FRAME,俺.心跳);
		};
		我.prototype.阴影改变 = function(value){
			var 俺 = this;
			俺.heroShadows[0].visible = value;
			俺.heroShadows[1].visible = value;
		};
		我.prototype.置矩形 = function(){
			var 俺 = this;
			俺.rect = new LRectangle(50 + 俺.hero.x,22 + 俺.hero.y,50,86);
		};
		我.prototype.无敌 = function(){
			return this.effect.visible;
		};
		我.prototype.心跳 = function(event){
			var 俺 = event.target;
			if(苦游戏主体.为停止()){
				if(俺.hero.mode != 0){
					俺.hero.stop();
				}
				return;
			}else if(俺.hero.mode == 0){
				俺.hero.play();
			}
			俺.y += 俺.vy;
			俺.vy += 苦值;
			if(俺.无敌()){
				苦星控制.改值(-0.1);
				if(苦星控制.value <= 0){
					俺.effect.visible = false;
					俺.阴影改变(false);
				}
			}
			if(俺.vy > 32)俺.vy = 32;
			if(俺.y > LGlobal.height + 100){
				俺.die();
		//		MySoundPlayer.playSound("gameover");
				俺.parent.游戏结束();
				return;
			}
			俺.distance += 常移步;
			var countValue = 俺.distance / 俺.countValue >>> 0;
			if(俺.distanceObj && 俺.distanceObj.value < countValue){
				俺.distanceObj.置值(countValue);
			}
			if(俺.action == 我.飞){
				俺.hp.改值(-0.5);
				if(俺.hp.value <= 1){
					俺.跳起来();
				}else{
		//			MySoundPlayer.playSound("飞");
					俺.vy = 0;
					俺.y -= 4;
					if(俺.y < 64)俺.y = 64;
				}
				return;
			}else if(俺.action == 我.伤){
				if(俺.hertCount-- < 0){
					俺.运行起来();
				}
			}else{
				俺.hp.改值(0.05);
			}
			if(俺.vy < 0)return;
			var checkList = 苦运行地图.childList,child;
			for(var i=0,l=checkList.length;i<l;i++){
				child = checkList[i];
				if(child.检查碰撞点(俺.x,俺.y)){
					俺.y = child.y;
					俺.vy = 0;
					俺.jumpCount = 0;
					俺.运行起来();
					break;
				}
			}
		};
		我.prototype.跳 = function(){
			var 俺 = this;
			if(俺.action == 我.伤)return;
			if(俺.jumpCount < 2){
		//		MySoundPlayer.playSound("跳");
				俺.vy = -30;
				俺.jumpCount++;
				俺.跳起来();
			}else if(俺.hp.value > 1){
				俺.飞();
			}
		};
		我.prototype.跳完 = function(){
			var 俺 = this;
			if(俺.action == 我.伤)return;
			俺.跳起来();
		};
		我.prototype.跳起来 = function(){
			var 俺 = this;
			if(俺.action == 我.跳)return;
			俺.action = 我.跳;
			俺.hero.gotoAndPlay(我.跳);
		};
		我.prototype.飞 = function(){
			var 俺 = this;
			if(俺.action == 我.飞)return;
			俺.action = 我.飞;
			俺.hero.gotoAndPlay(我.飞);
			俺.hero.onframe();
		};
		我.prototype.运行起来 = function(){
			var 俺 = this;
			if(俺.action == 我.走)return;
			if(俺.action == 我.伤 && 俺.hertCount>=0)return;
			俺.action = 我.走;
			俺.hero.gotoAndPlay(我.走);
			俺.hero.onframe();
		};
		我.prototype.伤 = function(){
			var 俺 = this;
			if(俺.action == 我.伤)return;
			俺.action = 我.伤;
			俺.hero.gotoAndPlay(我.伤);
			俺.hertCount = 10;
			俺.hp.改值(-20);
		};
		///////////////////////////////////////
		function 商标(){
			base(this,LSprite,[]);
			this.初始();
		}
		商标.prototype.初始 = function(){
			var 俺 = this,labelText;
			var bitmap = new LBitmap(new LBitmapData(苦数据列表["logo"]));
			俺.addChild(bitmap);
			俺.addEventListener(LMouseEvent.MOUSE_UP, 俺.开始);
		};
		商标.prototype.开始 = function(event){
			var 俺 = event.clickTarget;
//			游戏开始();
			gamePage.play();
			//bgmusic.replay();	
		};
		///////////////////////////////////////
		function 地图(){
			base(this,LSprite,[]);
			this.初始();
		}
		地图.prototype.初始 = function(){
			var 俺 = this;
			俺.dieFloorList = [];
			俺.加底部(2);
			俺.floor.x = 0;
			俺.addEventListener(LEvent.ENTER_FRAME,俺.心跳);
		};
		地图.prototype.心跳 = function(event){
			var 俺 = event.target;
			if(苦游戏主体.为停止())return;
			while(俺.dieFloorList.length > 0){
				var child = 俺.dieFloorList.shift();
				俺.removeChild(child);
			}
		};
		地图.prototype.加底部 = function(index){
			var 俺 = this;
			俺.floor = StageData.取底部(index);
			俺.addChild(俺.floor);
			俺.floor.addEventListener(底部.OUT_COMPLETE,俺.取底部);
			俺.floor.addEventListener(底部.OUT_DIE,俺.加死亡底部);
		};
		地图.prototype.取底部 = function(event){
			var 俺 = event.target.parent;
			俺.floor.removeEventListener(底部.OUT_COMPLETE,俺.取底部);
			俺.加底部(1);
		};
		地图.prototype.加死亡底部 = function(event){
			var 俺 = event.target.parent;
			俺.dieFloorList.push(event.target);
		};
		///////////////////////////////////////
		var StageData = {
			取底部:function(index){
				var floor;
				floor = new 底部(index);
				return floor;
			}
		};
		///////////////////////////////////////
		function 游戏主体(points){
			base(this,LSprite,[]);
			this.初始(points);
		}
		游戏主体.prototype.初始 = function(points){
			var 俺 = this;
			俺.moveStepCount = 0;
			俺.gameover = false;
			var background = new 背景();
			俺.addChild(background);
			俺.speedBitmap = new LBitmap(new LBitmapData(苦数据列表["stage"],32*14,32*3,40,48));
			俺.speedBitmap.x = 32;
			俺.speedBitmap.y = 30;
			俺.speedBitmap.visible = false;
			俺.addChild(俺.speedBitmap);
			苦项目层 = new LSprite();
			苦名人层 = new LSprite();
			苦运行地图 = new 地图();
			俺.addChild(苦运行地图);
			俺.addChild(苦项目层);
			俺.addChild(苦名人层);
			var hp = new 血();
			hp.x = 16;
			hp.y = 10;
			苦星控制 = new 星(points);
			苦星控制.x = 32 + hp.getWidth();
			苦星控制.y = 2;
			苦运行角色 = new 我(hp);
			苦运行角色.x = 32 * 8;
			苦运行角色.y = 32 * 4;
			苦运行角色.置矩形();
			俺.addChild(苦运行角色);
			俺.character = 苦运行角色;
			俺.addChild(hp);
			俺.addChild(苦星控制);
			
			俺.stopBitmapData = new LBitmapData(苦数据列表["stage"],32*23,32*3,64,64);
			俺.playBitmapData = new LBitmapData(苦数据列表["stage"],32*25,32*3,64,64);
			俺.stopBitmap = new LBitmap(俺.stopBitmapData);
			俺.stopBitmap.x = 416;
			俺.stopBitmap.y = 16;
			俺.addChild(俺.stopBitmap);
			俺.addEventListener(LMouseEvent.MOUSE_UP, 俺.mouseup);
			俺.addEventListener(LMouseEvent.MOUSE_DOWN, 俺.mousedown);
			俺.addEventListener(LEvent.ENTER_FRAME,俺.心跳);
		};
		游戏主体.prototype.为停止 = function(){
			if(苦停止标志 || 苦运行角色.spiritCount > 0){
				return true;
			}
			return false;
		};
		游戏主体.prototype.心跳 = function(event){
			var 俺 = event.target,child,i,l;
			if(苦游戏主体.为停止())return;
			if(常移步 == 常移步快){
				if(俺.moveStepCount-- <= 0 && !苦运行角色.无敌()){
					常移步 = 常移步慢;
					俺.speedBitmap.visible = false;
				}
			}
			for(i=0,l=苦名人层.childList.length;i<l;i++){
				child = 苦名人层.childList[i];
				if(child.x < -96){
					child.remove();
					i--;
					l--;
				}
			}
			for(i=0,l=苦项目层.childList.length;i<l;i++){
				child = 苦项目层.childList[i];
				if(child.x < -96){
					child.remove();
					i--;
					l--;
				}
			}
		};
		游戏主体.prototype.mousedown = function(event){
			var 俺 = event.clickTarget;
			if(event.selfX > 俺.stopBitmap.x && event.selfX < 俺.stopBitmap.x + 俺.stopBitmap.getWidth() && 
				event.selfY > 俺.stopBitmap.y && event.selfY < 俺.stopBitmap.y + 俺.stopBitmap.getHeight()){
				if(苦停止标志){
					俺.stopBitmap.bitmapData = 俺.stopBitmapData;
		//			MySoundPlayer.background.play();
				}else{
					俺.stopBitmap.bitmapData = 俺.playBitmapData;
		//			MySoundPlayer.background.stop();
				}
				苦停止标志 = !苦停止标志;
				return;
			}
			if(苦游戏主体.为停止())return;
		//	MySoundPlayer.loadSound();
			俺.character.跳();
		};
		游戏主体.prototype.mouseup = function(event){
			var 俺 = event.clickTarget;
			if(苦游戏主体.为停止())return;
			俺.character.跳完();
		};
		游戏主体.prototype.游戏结束 = function(event){
			苦停止标志 = true;
			var 俺 = this;
			俺.removeEventListener(LMouseEvent.MOUSE_UP, 俺.mouseup);
			俺.removeEventListener(LMouseEvent.MOUSE_DOWN, 俺.mousedown);
			var overLayer = new 游戏结束();
			俺.addChild(overLayer);
		};
		///////////////////////////////////////
		function 底部(index){
			base(this,LSprite,[]);
			this.初始(index);
		}
		底部.OUT_COMPLETE = "floor_out_complete";
		底部.OUT_DIE = "floor_out_die";
		底部.prototype.初始 = function(index){
			var 俺 = this;
			俺.isOutComplete = false;
			俺.x = LGlobal.width;
			俺.y = 64*6 + 32*(8*Math.random() >>> 0);
			俺.isStart = false;
			var bitmap,rightBitmap;
			switch(index){
				case 1:
					bitmap = new LBitmap(new LBitmapData(苦数据列表["stage"],0,0,32*(3 + (19*Math.random() >>> 0)),96));
					bitmap.y = -32;
					俺.addChild(bitmap);
					break;
				default:
					俺.isStart = true;
					bitmap = new LBitmap(new LBitmapData(苦数据列表["stage"],0,0,960,96));
					bitmap.y = -32;
					俺.addChild(bitmap);
					rightBitmap = true;
					break;
			}
			if(!rightBitmap){
				rightBitmap = new LBitmap(new LBitmapData(苦数据列表["stage"],32*29,0,32,96));
				rightBitmap.x = bitmap.getWidth();
				rightBitmap.y = -32;
				俺.addChild(rightBitmap);
			}
			俺.maxRight = LGlobal.width - 32*2 - 32*(10*Math.random() >>> 0);
			俺.right = 俺.getWidth();
			俺.bottom = 32*2;
			名人.加(俺);
			俺.addEventListener(LEvent.ENTER_FRAME,俺.心跳);
		};
		底部.prototype.心跳 = function(event){
			var 俺 = event.target;
			if(苦游戏主体.为停止())return;
			俺.x -= 常移步;
			if(!俺.isOutComplete && 俺.x + 俺.getWidth() < 俺.maxRight){
				俺.isOutComplete = true;
				俺.dispatchEvent(底部.OUT_COMPLETE);
			}else if(俺.x + 俺.getWidth() < 0){
				俺.dispatchEvent(底部.OUT_DIE);
				俺.die();
			}
		};
		底部.prototype.检查碰撞点 = function(x,y){
			var 俺 = this;
			if(x > 俺.x && x < 俺.x + 俺.right && y > 俺.y && y< 俺.y + 俺.bottom){
				return true;
			}
			return false;
		};
		///////////////////////////////////////
		function 血(){
			base(this,LSprite,[]);
			this.初始();
		}
		血.prototype.初始 = function(){
			var 俺 = this;
			var HP_bg = new LBitmap(new LBitmapData(苦数据列表["HP_bg"]));
			HP_bg.x = 445;			//-15
			HP_bg.y = 100;		//-2
			俺.addChild(HP_bg);
			俺.value = 俺.maxValue = 100;
			俺.HP_value = new LBitmap(new LBitmapData(苦数据列表["HP_value"]));
			俺.HP_value.x = 453;			//-15
			俺.HP_value.y = 102;		//-2
			俺.addChild(俺.HP_value);
		};
		血.prototype.改值 = function(value){
			var 俺 = this;
			俺.value += value;
			if(俺.value < 1){
				俺.value = 1;
			}else if(俺.value > 100){
				俺.value = 100;
			}
			俺.HP_value.scaleX = 俺.value/俺.maxValue;
		};
		///////////////////////////////////////

		///////////////////////////////////////
		function 名人(name){
			base(this,LSprite,[]);
			this.初始(name);
		}
		名人.prototype.初始 = function(name){
			var 俺 = this;
			俺.name = name;
			var data = new LBitmapData(苦数据列表[name],0,0,96,96);
			var list = LGlobal.divideCoordinate(384,96,1,4);
			俺.hero = new LAnimationTimeline(data,list);
			俺.hero.x = -48;
			俺.hero.y = -90;
			俺.hero.speed = 16;		//6
			俺.addChild(俺.hero);
			俺.vy = 0;
			俺.苦值 = 0;
			俺.speedx = 0;
			if(俺.name == "gui"){
				俺.苦值 = 苦值;
				俺.hero.y = -96;
				俺.rect = new LRectangle(-48,-70,96,70);
			}else if(俺.name == "bird"){
				俺.hero.y = -64;
				俺.speedx = 14;			//4
				俺.rect = new LRectangle(-32,-32,64,32);
			}
			//俺.graphics.drawRect(2,"#ff0000",[俺.rect.x,俺.rect.y,俺.rect.width,俺.rect.height],true,"#880088");
			俺.addEventListener(LEvent.ENTER_FRAME,俺.心跳);
		};
		名人.prototype.心跳 = function(event){
			var 俺 = event.target;
			if(苦游戏主体.为停止()){
				if(俺.hero.mode != 0){
					俺.hero.stop();
				}
				return;
			}else if(俺.hero.mode == 0){
				俺.hero.play();
			}
			俺.检查碰撞();
			俺.y += 俺.vy;
			俺.vy += 俺.苦值;
			俺.x -= (常移步 + 俺.speedx);
			if(俺.vy <= 0)return;
			var checkList = 苦运行地图.childList,child;
			for(var i=0,l=checkList.length;i<l;i++){
				child = checkList[i];
				if(child.检查碰撞点(俺.x,俺.y)){
					俺.y = child.y;
					俺.vy = 0;
					break;
				}
			}
		};
		名人.prototype.检查碰撞 = function(){
			var 俺 = this;
			if(俺.x < -96)return;
			if(苦运行角色.rect.action != 我.伤){
				var ix = (俺.x + 俺.rect.x) > (苦运行角色.x + 苦运行角色.rect.x) ? (俺.x + 俺.rect.x) : (苦运行角色.x + 苦运行角色.rect.x);
				var iy = (俺.y + 俺.rect.y) > (苦运行角色.y + 苦运行角色.rect.y) ? (俺.y + 俺.rect.y) : (苦运行角色.y + 苦运行角色.rect.y);
				var ax = (俺.x + 俺.rect.x + 俺.rect.width) > (苦运行角色.x + 苦运行角色.rect.x + 苦运行角色.rect.width) ? (苦运行角色.x + 苦运行角色.rect.x + 苦运行角色.rect.width) : (俺.x + 俺.rect.x + 俺.rect.width);
				var ay = (俺.y + 俺.rect.y + 俺.rect.height) > (苦运行角色.y + 苦运行角色.rect.y + 苦运行角色.rect.height) ? (苦运行角色.y + 苦运行角色.rect.y + 苦运行角色.rect.height) : (俺.y + 俺.rect.y + 俺.rect.height);
				if(ix <= ax && iy <= ay){
					if(苦运行角色.无敌()){
						俺.removeEventListener(LEvent.ENTER_FRAME,俺.心跳);
						LTweenLite.to(俺,4,{y:Math.random()>0.5?-LGlobal.height:LGlobal.height*2,x:-200,ease:Elastic.easeOut});
					}else{
						苦运行角色.伤();
					}
				}
			}
		};
		名人.加 = function(floor){
			if(floor.isStart)return;
			var npc;
			var randNum = Math.random();
			if(randNum > 0.8){
				npc = new 名人("gui");
				npc.y = floor.y - 32;
			}else if(randNum > 0.6){
				npc = new 名人("bird");
				npc.y = floor.y - npc.getHeight();
			}else{
				项.加(floor);
			}
			if(npc){
				npc.x = 48 + floor.x + (floor.getWidth() - 96)*Math.random();
				苦名人层.addChild(npc);
			}
		};
		///////////////////////////////////////
		function 项(name){
			base(this,LSprite,[]);
			this.初始(name);
		}
		项.MODE_LIVE = "live";
		项.MODE_GET = "get";
		项.MODE_DELETE = "delete";
		项.prototype.初始 = function(name){
			var 俺 = this;
			俺.name = name;
			if(俺.name == "star"){
				俺.bitmap = new LBitmap(new LBitmapData(苦数据列表["stage"],32*9,32*3,32,32));
			}else if(俺.name == "speed"){
				俺.bitmap = new LBitmap(new LBitmapData(苦数据列表["stage"],32*14,32*3,40,48));
				俺.bitmap.x = -1;
				俺.bitmap.y = -8;
			}else if(俺.name == "solution"){
				俺.bitmap = new LBitmap(new LBitmapData(苦数据列表["stage"],32*16,32*3,40,48));
				俺.bitmap.x = -4;
				俺.bitmap.y = -8;
			}
			俺.mode = 项.MODE_LIVE;
			俺.addChild(俺.bitmap);
			俺.addEventListener(LEvent.ENTER_FRAME,俺.心跳);
		};
		项.prototype.心跳 = function(event){
			var 俺 = event.target;
			if(苦游戏主体.为停止())return;
			if(俺.mode == 项.MODE_LIVE){
				俺.检查碰撞();
			}
			俺.x -= 常移步;
		};
		项.prototype.检查碰撞 = function(){
			var 俺 = this;
			if(俺.x < -130)return;
			if(苦运行角色.rect.action != 我.伤){
				var ix = 俺.x > (苦运行角色.x + 苦运行角色.rect.x) ? 俺.x : (苦运行角色.x + 苦运行角色.rect.x);
				var iy = 俺.y > (苦运行角色.y + 苦运行角色.rect.y) ? 俺.y : (苦运行角色.y + 苦运行角色.rect.y);
				var ax = (俺.x + 32) > (苦运行角色.x + 苦运行角色.rect.x + 苦运行角色.rect.width) ? (苦运行角色.x + 苦运行角色.rect.x + 苦运行角色.rect.width) : (俺.x + 32);
				var ay = (俺.y + 32) > (苦运行角色.y + 苦运行角色.rect.y + 苦运行角色.rect.height) ? (苦运行角色.y + 苦运行角色.rect.y + 苦运行角色.rect.height) : (俺.y + 32);
				if(ix <= ax && iy <= ay){
					if(俺.name == "star"){
						苦星控制.改值(1);
					}else if(俺.name == "speed"){
						苦游戏主体.moveStepCount = 200;
						苦游戏主体.speedBitmap.visible = true;
						常移步 = 常移步快;
					}else if(俺.name == "solution"){
						苦运行角色.hp.改值(20);
					}
		//			MySoundPlayer.playSound("get");
					俺.mode = 项.MODE_GET;
					LTweenLite.to(俺.bitmap,0.2,{y:-10,scaleX:0.1,alpha:0.75,ease:LEasing.None})
				    .to(俺.bitmap,0.2,{y:-20,scaleX:1,alpha:0.5,ease:LEasing.None})
				    .to(俺.bitmap,0.2,{y:-30,scaleX:0.1,alpha:0.25,ease:LEasing.None})
				    .to(俺.bitmap,0.2,{y:-40,scaleX:1,alpha:0,ease:LEasing.None});
				}
			}
		};
		项.加 = function(floor){
			var item,i;
			var randNum = Math.random();
			if(randNum > 0.7){
				return;
			}
			var maxnum = floor.getWidth()/32 >>> 0,addnum;
			if(maxnum > 5){
				addnum = 5 + ((maxnum - 5)*Math.random() >>> 0);
			}else{
				addnum = maxnum;
			}
			var sx = floor.x + (floor.getWidth() - addnum*32)*0.5;//路上出来的“心”★
			var specialItem = false;
			for(i=0;i<addnum;i++){
				if(i % 2 == 0)continue;
				randNum = Math.random();
				if(randNum > 0.95 && !specialItem){
					specialItem = true;
					item = new 项("speed");
				}else if(randNum > 0.9 && !specialItem){
					specialItem = true;
					item = new 项("solution");
				}else{
					item = new 项("star");
				}
				item.x = sx + i*32;
				item.y = floor.y - 32;
				苦项目层.addChild(item);
			}
		};
		function 星(points){
			base(this,LSprite,[]);
			this.初始(points);
		}
		星.prototype.初始 = function(points){
			var 俺 = this;
			if(points == undefined){
				points = 0;
			}
			var Star_bg = new LBitmap(new LBitmapData(苦数据列表["stage"],32*9,32*4,32*5,32));
			俺.addChild(Star_bg);
			俺.value = points;
			俺.maxValue = 50000;
			俺.Star_value = new LBitmap(new LBitmapData(苦数据列表["stage"],32*9,32*3,32*5,32));
			俺.addChild(俺.Star_value);
			俺.改值(0);
		};
		星.prototype.改值 = function(value){
			var 俺 = this;
			俺.value = parseInt(俺.value) + parseInt(value);
			俺.Star_value.visible = true;
			if(俺.value < 0){
				俺.value = 0;
				俺.Star_value.visible = false;
				return;
			}else if(俺.value > 俺.maxValue){
				俺.value = 俺.maxValue;
			}
			console.log(俺.value);
			$('.hudie').show();
			$('#hudie').html(俺.value);
			
			俺.Star_value.bitmapData.setProperties(32*9,32*3,32*5*俺.value/俺.maxValue,32);
			if(俺.value == 俺.maxValue && !苦运行角色.无敌()){
				苦运行角色.spiritCount = 4;
				苦运行角色.hero.stop();
				//苦运行角色.心灵开始();
			}
		};
		///////////////////////////////////////
		function 游戏结束(){
			base(this,LSprite,[]);
			endGame(_gid);
			this.初始();
		}
		游戏结束.prototype.初始 = function(){
			var 俺 = this;
			俺.overLayer = new LSprite();
			俺.addChild(俺.overLayer);
			$('.b_1').show();
			$('.b_1_1').show();
		};
    }

}
	
	</script>
	<style>
		.page{	
			background:;
			background-size:100% auto;
			background-repeat:no-repeat;
			background-position:center 0;
		    background-size:100% auto;
		    text-align: center;
		    position:absolute;top:0;left:0;width:100%;min-height:100%;overflow:hidden;max-width:640px;min-width:320px;z-index:1;
		    background-color: #e5e6df;
		}
		
		.hudie{position: absolute;z-index: 99;width: 5rem;top: 1rem;background-image: url(https://magicactivity.oss-cn-hangzhou.aliyuncs.com/spdbcat/bf.png);background-position: left center;background-repeat: no-repeat;height: 1.6rem;line-height: 1.6rem;text-align: right;left: 6.875rem;}
		.b_1{width:18.75rem;position:fixed;top:0;left:0;height:100%;z-index:103;background:rgba(0,0,0,0.7);text-align: center;}
		.b_1_1{background: url(https://magicactivity.oss-cn-hangzhou.aliyuncs.com/spdbcat/b2_tk.png);background-size: 100%;width: 10.8rem;height: 10.5rem;position: absolute;left: 3.975rem;top: 10rem;}
		.b_1_1 h4{margin-top: 1.8rem;width: 100%;font-size: 0.8rem;}
		.b_1_1 span{margin-top: 0.5rem;width: 100%;font-size: 0.7rem;left: 0;}
		.b_1_btn{background: url(https://magicactivity.oss-cn-hangzhou.aliyuncs.com/spdbcat/b2_btn.png) ;background-size: 100%;width: 6.375rem;height: 1.7rem;margin:0.5rem 0 0 2.2125rem;font-size: 0.7rem;line-height: 1.7rem;}
		.fxtc{width: 100%;height: 100%;background-image: url(https://magicactivity.oss-cn-hangzhou.aliyuncs.com/spdbcat/fxtc.png);background-size: 100%;position: absolute;left:0;top: 0;z-index: 121;}
		.b_2{width:18.75rem;position:fixed;top:0;left:0;height:100%;z-index:103;background:rgba(0,0,0,0.7);text-align: center;}
		.b_2_2{background: url(https://magicactivity.oss-cn-hangzhou.aliyuncs.com/spdbcat/b2_tk.png);background-size: 100%;width: 15.75rem;height: 15.3rem;position: absolute;left: 2rem;top: 5rem;font-size: 0.6rem;text-align: left;}
		.b_2_2 p{width: 90%;margin-left: 5%;}
		.p1{margin-top: 5.5rem;}
		.b_2_btn{width: 8rem;height: 1.4rem;line-height: 1.4rem;margin-left: 3.5rem;text-align: center;margin-top: 1.2rem;border:1px solid black;border-radius: 2rem;}
		
	</style>
</head>
<body >
	<div class="page " id="page">	
		
		<div id="legend" style="display: block;"></div>		
		<div class="hudie" id="hudie" style="display: none;"></div>
		
    </div>
    
	<div class="b_1" style="display: none;"></div>
	
	<div class="b_2" style="display: none;"> 
		<div class="b_2_2">
			
			<p class="p1">1、点击黑猫跳起，有体力值时长按可短暂飞行，躲避障碍物抓取蝴蝶；</p>
			<p>2、触碰到障碍物扣减体力值/掉落、未上到台阶落下则游戏结束；</p>
			<p>3、游戏结束时可点save me邀请好友救助，如被救助可继续游戏，否则结束游戏或重新开始新游戏；</p>
			<p>4、获得30只蝴蝶可参与抽奖。</p>
			<div class="b_2_btn">确定</div>
		</div>
	</div>
		
	<div class="fxtc" id="fxtc" style="display: none;"></div>
</body>
	
</html>